<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–í–∏—Ç—Ä–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤</title>
    <!-- JavaScript –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <script>
        function editComment(id) {
            var comment = document.getElementById("comment" + id);
            var newComment = document.createElement("textarea");
            newComment.innerHTML = comment.innerHTML;
            newComment.rows = 3;
            newComment.name = "text";
            newComment.style = "width:100%;";
            comment.parentNode.replaceChild(newComment, comment);

            var button = document.getElementById(id);
            button.remove();

            var newButton = document.createElement("button");
            newButton.innerHTML = "‚úì";
            newButton.type = "submit";
            newButton.style = "float:right;";
            newComment.parentNode.appendChild(newButton);
        }

        function addComment() {
            var button = document.getElementById("addCommentButton");
            button.remove();

            var form = document.getElementById("addCommentForm");

            var newComment = document.createElement("textarea");
            newComment.rows = 3;
            newComment.name = "text";
            newComment.style = "width:100%;";
            form.insertBefore(newComment, form.firstChild);

            var newButton = document.createElement("button");
            newButton.innerHTML = "‚úì";
            newButton.type = "submit";
            newButton.style = "float:right;";
            form.appendChild(newButton);
        }
    </script>
</head>
<body>
<!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É -->
<a href="@{/posts}}" style="float:right;">
    <b>–ù–ê –ì–õ–ê–í–ù–£–Æ ‚§µ</b>
</a>
<table style="width:50%;margin-left:auto;margin-right:auto;">
    <tr>
        <td>
            <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
            <form method="GET" th:action="@{/posts/{id}/edit(id=${post.id})}">
                <button style="float:right;">–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ –ü–û–°–¢</button>
            </form>
        </td>
        <td>
            <!-- –§–æ—Ä–º–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ -->
            <form method="POST" th:action="@{/posts/{id}/delete(id=${post.id})}">
                <button style="float:right;">–£–î–ê–õ–ò–¢–¨ –ü–û–°–¢</button>
            </form>
        </td>
    </tr>
    <tr>
        <td>
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞ -->
            <h2 th:text="${post.title}"></h2>
            <p>
                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
                <img height="300" th:src="@{${post.imageUrl} ?: '/static/images/placeholder.jpg'}">
            </p>
            <p>
                <!-- –§–æ—Ä–º–∞ –¥–ª—è –ª–∞–π–∫–æ–≤ -->
            <form th:action="@{/posts/{id}/like(id=${post.id})}" method="post">
                <button name="like" value="true">üëç</button>
                <span th:text="${post.likes}"></span>
                <button name="like" value="false">üëé</button>
                <span th:text="${'–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ' + post.comments.size()}" style="float:right;"></span>
            </form>
            </p>
            <p>
                <!-- –¢–µ–≥–∏ –ø–æ—Å—Ç–∞ -->
                <span th:each="tag : ${post.tags}" th:text="${tag.name} + ' '"></span>
            </p>
        </td>
    </tr>
    <!-- –û—Ç–ª–∞–¥–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ—Å—Ç–∞ -->
    <tr>
        <td>Debug: Content = <span th:text="${post.content} ?: 'No content'"></span></td>
    </tr>
    <!-- –ê–±–∑–∞—Ü—ã —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞ -->
    <tr th:each="paragraph : ${#strings.arraySplit(post.content != null ? post.content : '', '\n')}">
        <td th:text="${paragraph}"></td>
    </tr>
    <tr>
        <td>
            <hr>
            <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
            <!-- –û—Ç–ª–∞–¥–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
            <p>Debug: Number of comments = <span th:text="${post.comments.size()}"></span></p>
        </td>
    </tr>
    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <tr th:each="comment : ${post.comments}">
        <td style="border-left:thin solid grey;">
            <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            <form method="POST" th:action="@{/comments/{id}/edit(id=${comment.getId()})}">
                <span th:id="${'comment' + comment.getId()}" th:text="${comment.content}"></span>
                <button th:id="${comment.getId()}" onclick="editComment(this.id)" style="float:right;">‚úé</button>
            </form>
        </td>
        <td>
            <!-- –§–æ—Ä–º–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            <form method="POST" th:action="@{/comments/{id}/delete(id=${comment.getId()})}">
                <button style="float:right;">‚úó</button>
            </form>
        </td>
    </tr>
    <tr>
        <td>
            <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
            <form id="addCommentForm" th:action="@{/comments}" method="post">
                <input type="hidden" name="postId" th:value="${post.id}">
                <textarea rows="3" name="text" style="width:100%;"></textarea>
                <button id="addCommentButton" type="submit" style="float:right;">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
            </form>
        </td>
    </tr>
</table>
</body>
</html>